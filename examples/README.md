# Examples for use of NBI in Laplace and Helmholtz problems

To run all of the test cases for Laplace and Helmholtz problems:

`. test-all-laplace`

and

`. test-all-helmholtz`

These will enter each directory in turn and run the tests, logging
output to `test-[laplace|helmholtz].log` and estimated error norms to
`test-[laplace|helmholtz]-norm.log`.

The examples in each directory are run using the scripts
`solve-helmholtz` and `solve-laplace`, which can also be used to
configure the problem. Each directory contains scripts `make-geometry`
and `make-visualization-grid` which generate a surface mesh and a
visualization mesh, respectively. There are also configurable boundary
condition (source) files which are used in running the tests.

A number of test cases use a source contained inside the surface. When
the boundary condition is generated in this way, the resulting
solution should be identical to the potential computed using the
interior source. The NBI solver returns error estimates (L_2, L_inf,
and r.m.s.) computed as the difference between the potential specified
in the boundary condition file, and that computed by the solver.

The output from the calculation which can be visualized using GMSH is
two `.msh` files, one named according to the geometry of the problem,
e.g. `sphere.msh`, and one called `grid.msh` which shows the computed
field around the surface.

To run a test case, from inside the directory use the script
`solve-helmholtz` or `solve-laplace` as appropriate. For example:

```
cd .../examples/SphereHelmholtz
../solve-helmholtz -k 1.0
gmsh sphere.msh
```

generates a spheroidal surface and solves the boundary integral
problem with an interior point source of wavenumber 1.0. The command
`gmsh sphere.msh` displays the solution surface potential. Output from
the solver will be in a file called `solution.log`, which contains
details of the progress of the solution. The last few lines will look
something like this:

```
nbi-solve-helmholtz: 1 iterations; error = 5.09449e-07 [287.509] (287.48)
nbi-solve-helmholtz: emax = 0.00250532; fmax = 0.172267;
nbi-solve-helmholtz: L_inf norm = 0.0145432; L_2 norm = 0.00484112; rms error = 
5.03861e-06
```

Figures in square brackets, such as `[287.509]` are wall-clock time
since the solver started, and are used to assess code performance. The
next line gives the absolute value of the maximum difference between
computed potential and input boundary condition potential (valid for
an internal source) and the maximum absolute value of the boundary
condition. The last line gives the various error norms. When an
internal source is used to generate the boundary condition, these
norms are an assessment of the accuracy of the solution on the
supplied surface discretization. 


# Test cases

SphereLaplace
: solve for the Laplace potential on an ellipsoid (deformed sphere)

SphereHelmholtz
: solve for the Helmholtz (wave equation) potential on an ellipsoid
		 under excitation from a sinusoidally varying ring source
		 (this can be used to simulate rotor and propeller noise).

Flow
: solve the Laplace equation to compute the potential around a
	  sphere in a uniform flow. The error norms reported by the solver
	  in this case are not meaningful, because the boundary condition
	  is not generated by an internal source. Instead, the accuracy of
	  the result can be checked in Octave, using a script in the
	  directory. The README file in the directory explains how to do
	  this. 

Wing
: solve the Laplace or Helmholtz problem for a point source inside
      a wing-type geometry, generated using the AGG library. 

Scattering
: solve for scattering of a plane wave by a sphere, with
	    comparison to the analytical series solution. The error norms
	    reported by the solver in this case are not meaningful,
	    because the boundary condition is not generated by an internal
	    source. Instead, the accuracy of the result can be checked in
	    Octave, using a script in the directory. The README file in
	    the directory contains instructions on how to perform the
	    check.

Rotor
: solve the problem of scattering of noise from an azimuthally
       varying circular source, which simulates a rotor interacting
       with a simple nacelle

Catseye
: solve for a point source inside a cat's eye geometry,
	 generated using a GMSH input file. This is run by both the
	 Laplace and Helmholtz test scripts. 

# Parameters

The shell scripts take a number of options, which can be set from the
command line using the following options:

- -k k:        acoustic wavenumber, for Helmholtz problems
- -a nqa:      number of quadrature points in rule used for adaptive integration
- -p nqp:      number of quadrature points on discretized patches
- -u nqu:      number of quadrature points on upsampled patches
- -t tol:      adaptive integration tolerance
- -o order:    order of singular integration
- -e eta:      near/far field cutoff parameter
- -d depth:    maximum recursion depth for adaptive quadrature
- -T nthreads: number of threads to use in threaded computations
- -s src:      boundary condition (source) filename
