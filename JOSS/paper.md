---
title: 'NBI: A library for Nystrom Boundary Integral calculations'
tags:
  - Nystrom Boundary Integral method
  - Helmholtz equation
  - Laplace equation
  - Fast Multipole Method
  - acoustics
  - potential
authors:
  - name: Michael J. Carley
    orcid: 0000-0003-2965-8984
    affiliation: 1
affiliations:
 - name: Department of Mechanical Engineering, University of Bath, UK
   index: 1
date: 12 September 2023
bibliography: paper.bib
--- 

# Summary

Boundary integral methods are a popular approach to solving potential
problems, in particular for the Laplace and Helmholtz problems in such
areas as fluid dynamics, acoustics, and electromagnetism. They are a
natural choice for the solution of problems in unbounded domains, such
as wave scattering, where the radiation boundary condition is
automatically satisfied by the nature of the formulation. The Nystrom
method is one approach to the solution of boundary integral problems,
which lends itself to acceleration using the Fast Multipole Method
(FMM). NBI is a library for the solution of boundary integral problems
based on the approach of [@greengard-oneil-rachh-vico21] and the FMM
methods of [@gumerov-duraiswami03; @gumerov-duraiswami04;
@gumerov-duraiswami05; @gumerov-duraiswami09]. The code includes a
number of executables which can be used to set up and solve problems
on realistic geometries, with a number of examples provided for
testing of the solver. Results can be visualized using GMSH
[@geuzaine-remacle09], a standard free meshing program.

# Statement of need

A number of free boundary integral codes exist which can be used for
problems of the type handled by NBI [@kirkup07; @betcke-scroggs21, for
example], with different approaches to discretization and solution,
ranging from collocation methods with direct solvers, suitable for
relatively small problems, to FMM-accelerated Galerkin techniques with
iterative solvers, which can be used on large complex geometries. NBI
implements recent work on high-order solution of boundary integral
problems [@greengard-oneil-rachh-vico21] in a form which can be used
for a range of engineering applications. The principal motivation is
the solution of potential problems in acoustics and aerodynamics. As
well as the library proper, there are codes for discretization of
general geometries supplied in a number of formats; matrix assembly
and problem solution; field evaluation; and post-processing and
visualization of results. A built-in parser gives a flexible and
intuitive means of evaluating boundary conditions, which are supplied
as analytical expressions parsed and evaluated on the surface. This
allows boundary conditions to be specified in a form which makes it
easier to perform parametric studies by systematically modifying
internal variables. 

Simple geometries, such as spheres and ellipsoids, are implemented as
internal functions. More general shapes can be produced using standard
GMSH inputs [@geuzaine-remacle09] or the CST method of Kulfan
[@kulfan10] which is implemented in an extended and more general form
in the AGG library which is included with the NBI distribution. This
allows the parametric specification of forms which arise in
aerodynamic applications, in a manner which is convenient for
optimisation and parametric studies. 

# Mathematics

The Laplace and Helmholtz potentials generated by a surface source
distribution are given by a boundary integral
\begin{equation}
\phi(\mathbf{x})
	=
	\int_{S}
	\phi(\mathbf{y})\frac{\partial}{\partial n}G(\mathbf{x},\mathbf{y})
	-
	\frac{\partial\phi(\mathbf{y})}{\partial n}G(\mathbf{x},\mathbf{y})
	\,
	\mathrm{d}S(\mathbf{y}),
\end{equation}
where $G$ is the Green's function for the problem. For points lying on
the surface, the left hand side is replaced by $\phi/2$ and the
equation is interpreted as a boundary integral equation to be solved
subject to an appropriate boundary condition. By default, NBI
implements a Neumann (surface normal derivative) boundary condition as
that most appropriate to acoustic scattering and to potential problems
in fluid dynamics.

# Features

Details of the problem setup and solution procedure are given in the
code documentation, but the basic steps are:

- generation of a surface discretization;
- assembly of the system matrices;
- solution of the problem subject to a specified boundary condition;
- postprocessing, including evaluation of the potential field, and
  visualization.
  
Each of these steps is carried out using an appropriate executable,
and a full problem can be solved using a Unix or Linux shell script
which runs each step in turn. 

The intention has been to develop an implementation of the main
elements of [@greengard-oneil-rachh-vico21] in a code which is
relatively easy to use in applications. The principal differences
which a user will note between NBI and the reference implementation of
the method of [@greengard-oneil-rachh-vico21] are: the range of
geometry formats supported, including the widely used GMSH standard;
the use of the standard PETSc iterative solvers; and the ability to
define boundary conditions using a built-in parser for mathematical
expressions. 

## Surface generation and representation

Surfaces in NBI are represented as high-order triangular patches,
interpolated using Koornwindwer orthogonal polynomials
[@greengard-oneil-rachh-vico21]. A number of surface generation
methods are provided (built-in basic geometries, parametric surfaces,
GMSH geo files) allowing considerable flexibility in the workflow for
real problems.

## Quadrature rules

Two main types of quadrature rule are used in NBI. Surface points are
generated on each patch at the nodes of high order rules for triangles
[@wandzura-xiao03; @xiao-gimbutas10]. These nodes are used, via the
FMM, to evaluate the far-field interactions in the boundary
integrals. Near-field interactions are computed by subtracting the
terms generated by the surface sources and adding terms evaluated
using adaptive quadrature and specialized rules for quadrature on
triangles, pre-computed using methods for generalized Gaussian rules
[@bremer-gimbutas13]. These are hard-coded into the library and
selected automatically during matrix assembly.

## Solving problems

Problems in NBI are solved using iterative solvers with matrix-free
evaluation of integrals. The evaluation uses a Fast Multipole Method
[@gumerov-duraiswami03; @gumerov-duraiswami04; @gumerov-duraiswami05;
@gumerov-duraiswami09]. A GMRES solver is built in and there is an
optional interface to the PETSc library and its solvers
[@petsc-web-page]. Boundary conditions in NBI are specified using
analytical formulae which are parsed and evaluated at each surface
node. This allows an intuitive definition of boundary conditions,
where user-defined variables simplify parametric variation, and a
range of built-in functions for the most common boundary conditions
are also available. These include point sources for the Laplace and
Helmholtz problems, and ring sources for the simulation of rotor
acoustics in aeronautics.

## Postprocessing and visualization
![GMSH visualisation of output from sphere scattering
example.\label{fig:scattering}](scattering.png){width=50%}

\autoref{fig:scattering} shows the GMSH visualisation of the
scattered field from a sphere subject to plane wave excitation, one of
the test cases included in the package. 

![GMSH visualisation of output from rotor noise
example.\label{rotor}](rotor.png){width=50%}

\autoref{rotor} shows the GMSH visualisation of the
field scattered from an ellipsoid, subject to an incident field from a
ring source, a simple model for scattering of rotor noise by a
nacelle. 

# References
